---
title: "Inequality and Poverty in Brazil."
author: "Vitor Hugo Miro (UFC)"
date: "03/12/2021"

output: html_notebook

---

## Poverty

This analysis are based on data from the Continuous National Household Sample Survey (Pesquisa Nacional por Amostra de Domicílios Contínua) for 2019.

We will be using R and RStudio, as well as the appropriate libraries, to extract the data, calculate poverty and inequality indicators, and plot graphs to present this information.


```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
```

```{r, echo = FALSE, include=FALSE}
rm(list = ls())
options(scipen = 999)
```

```{r, include=TRUE}
# Carregar pacote
library(PNADcIBGE)
library(survey)
library(srvyr)
library(convey)
library(tidyverse)
```

```{r, include=TRUE}
# Definir variáveis utilizadas na análise em um vetor

variaveis <- c('Ano', 'UF', 'Estrato', 'UPA', 'V1008', 'V1014', 'V1032', 'V1022', 
               'V2001', 'V2005', 'VD4019', 'VD4020', 'VD4022', 'VD4048', 'VD5008')

```


```{r, include=TRUE}
# Carrega dados da PNADC 
pnadc <- get_pnadc(year = 2019,
                   vars = variaveis,
                   interview = 1,
                   design = TRUE,
                   labels = TRUE,
                   deflator = TRUE,
                   defyear = 2019)
```

```{r, echo = TRUE}
glimpse(pnadc)
```

## Measuring poverty

The poverty measures, commonly known as the Foster-Greer-Thorbecke (FGT) family of poverty, including:

- Poverty headcount index = FGT(0)
- Poverty gap index = FGT(1)
- Poverty severity index = FGT(2)


This poverty measures was calculated using the R `convey` library.

```{r, echo = TRUE}
pnadc <- convey_prep(pnadc)
class(pnadc)
```
**Poverty lines**
The World Bank’s poverty line are widely used international poverty lines, including US\$1.9 a day, US\$3.2 a day and US\$ 5.5 a day (in 2011 PPP). 


```{r, echo = TRUE}
fgt0 <- svyfgt(~VD5008, pnadc, g=0, abs_thresh = 436, na.rm = TRUE)
fgt0 <- round(fgt0, 4)*100

fgt1 <- svyfgt(~VD5008, pnadc, g=1, abs_thresh = 436, na.rm = TRUE)
fgt1 <- round(fgt1, 4)*100

fgt2 <- svyfgt(~VD5008, pnadc, g=2, abs_thresh = 436, na.rm = TRUE)
fgt2 <- round(fgt2, 4)*100
```

Considering the World Bank poverty line (an income of up to US\$5.5 per day or R\$436 per month), the poverty indicators are as follows:

- Poverty headcount index = `r (fgt0)`%.

- Poverty gap index = `r (fgt1)`%.

- Poverty severity index = `r (fgt2)`%.


## Poverty rate in 2019, by state (Unidade Federativa - UF)

Brazil is a country with a large territorial dimension and its regions present very heterogeneous social indicators.

```{r, echo = TRUE}
fgt0_uf <- survey::svyby(~VD5008,
                         by = ~UF,
                         design = pnadc,
                         FUN = svyfgt,
                         g=0, 
                         abs_thresh = 436,
                         na.rm = TRUE)
```

The graph below shows the poverty rate values for the Brazilian states.

```{r}

Norte <- c("Acre", "Amapá", "Amazonas", "Pará", "Rondônia", "Roraima", "Tocantins")
Nordeste <- c("Alagoas", "Bahia", "Ceará", "Maranhão", "Paraíba", "Pernambuco", 
              "Piauí", "Rio Grande do Norte", "Sergipe")
COeste <- c("Distrito Federal", "Goiás", "Mato Grosso", "Mato Grosso do Sul")
Sudeste <- c("Espírito Santo", "Minas Gerais", "Rio de Janeiro", "São Paulo")
Sul <- c("Paraná", "Rio Grande do Sul", "Santa Catarina")


fgt0_uf <- fgt0_uf %>% mutate(
    regiao = factor(case_when(UF %in% Norte ~ "Norte",
                              UF %in% Nordeste ~ "Nordeste",
                              UF %in% COeste ~ "Centro-Oeste",
                              UF %in% Sudeste ~ "Sudeste",
                              UF %in% Sul ~ "Sul")))
```


```{r, echo = TRUE}
fgt0_uf %>% 
    dplyr::as_tibble() %>%
    dplyr::mutate(UF = forcats::fct_reorder(UF, VD5008)) %>%
    ggplot2::ggplot(ggplot2::aes(x = VD5008, y = UF)) +
    ggplot2::geom_col(aes(fill = regiao)) +
    ggplot2::labs(title = "Poverty rate by UF (2019)",
                  subtitle = "Considering the US$ 5.50 PPP line.",
                  x = NULL,
                  y = NULL,
                  caption = "Source: IBGE/PNADC microdata.")+
    ggplot2::geom_text(aes(label= round(VD5008,2)), vjust=0.5, hjust=-0.2, size=2.5)
```

### Poverty rate in rural areas

```{r, echo = TRUE}
fgt0_uf_rural <- survey::svyby(~VD5008,
                               by = ~UF,
                               design = subset(pnadc, V1022 == "Rural"),
                               FUN = svyfgt,
                               g=0, 
                               abs_thresh = 436,
                               na.rm = TRUE)

fgt0_uf_rural <-fgt0_uf_rural %>% mutate(
    regiao = factor(case_when(UF %in% Norte ~ "Norte",
                              UF %in% Nordeste ~ "Nordeste",
                              UF %in% COeste ~ "Centro-Oeste",
                              UF %in% Sudeste ~ "Sudeste",
                              UF %in% Sul ~ "Sul")))
```

The graph below shows the rural poverty rate values for the Brazilian states.

```{r, echo = TRUE}
fgt0_uf_rural %>% 
    dplyr::as_tibble() %>%
    dplyr::mutate(UF = forcats::fct_reorder(UF, VD5008)) %>%
    ggplot2::ggplot(ggplot2::aes(x = VD5008, y = UF)) +
    ggplot2::geom_col(aes(fill = regiao)) +
    ggplot2::labs(title = "Poverty rate by UF - Rural areas (2019)",
                  subtitle = "Considering the US$ 5.50 PPP line.",
                  x = NULL,
                  y = NULL,
                  caption = "Source: IBGE/PNADC microdata.") +
    ggplot2::geom_text(aes(label= round(VD5008,2)), vjust=0.5, hjust=-0.2, size=2.5)
```

## Income inequality (Gini Index)

The Gini Index is a summary measure of income inequality.

```{r, echo = TRUE}
gini_uf <- survey::svyby(~VD5008,
                         by = ~UF,
                         design = pnadc,
                         FUN = svygini,
                         na.rm = TRUE)

gini_uf  <- gini_uf %>% mutate(
    regiao = factor(case_when(UF %in% Norte ~ "Norte",
                              UF %in% Nordeste ~ "Nordeste",
                              UF %in% COeste ~ "Centro-Oeste",
                              UF %in% Sudeste ~ "Sudeste",
                              UF %in% Sul ~ "Sul")))
```


```{r, echo = TRUE}
gini_uf %>% 
    dplyr::as_tibble() %>%
    dplyr::mutate(UF = forcats::fct_reorder(UF, VD5008)) %>%
    ggplot2::ggplot(ggplot2::aes(x = VD5008, y = UF)) +
    ggplot2::geom_col(aes(fill = regiao)) +
    ggplot2::labs(title = "Gini Index by UF (2019)",
                  x = NULL,
                  y = NULL,
                  caption = "Source: IBGE/PNADC microdata.")+
    ggplot2::geom_text(aes(label= round(VD5008,2)), vjust=0.5, hjust=-0.2, size=2.5)
```

